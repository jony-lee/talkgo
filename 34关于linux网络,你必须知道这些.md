# 网络性能篇

## 性能指标

**带宽**:链路的**最大**传输速率,单位为b/s(比特/秒)

**吞吐量**:单位时间**成功**传输的数据量,单位通常为比特/秒或者字节每秒.**吞吐量受到带宽限制**,吞吐量/带宽=网络使用率.

**延时**:表示从网络请求发出后，一直到收到远端响应，所需要的时间延迟.可以是建立连接需要的时间(TCP握手延时),或一个数据包往返所需的时间.

**PPS**:是Packet Per Second的缩写,表示与网络包为单位的传输速率.

**网络的可用性**(网络能否正常通信)

**并发连接数**(TCP连接数量)

**丢包率**(丢包百分比)

**重传率**(重新传输的网络包比例)

## 网络配置

第一步:查看网络接口的配置和状态

ifconfig/ip



1. 网络接口的状态指标
2. MTU大小,默认为1500
3. 网络接口的IP地址/子网/MAC地址.
4. 网络收发的字节数/包数/错误数/丢包情况

## 套接字信息

```shell
netstat -nlp | head -n 3
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program nametcp 
0 0 127.0.0.53:53 0.0.0.0:* LISTEN 840/systemd-resolve
```

接收队列（Recv-Q）和发送队列（Send-Q）需要你特别关注，它们通常应该是 0。当你发现它们不是 0 时，说明有网络包的堆积发生。

Recv-Q 表示套接字缓冲还没有被应用程序取走的字节数（即接收队列长度）

Send-Q 表示还没有被远端主机确认的字节数（即发送队列长度）

如果不是零的话,它们就积压了待发送或者待接收的数据.

**全连接**:服务器收到了客户端的 ACK，完成了 TCP 三次握手，然后就会把这个连接挪到全连接队列中。这些全连接中的套接字，还需要被 accept() 系统调用取走，服务器才可以开始真正处理客户端的请求。

**半连接**:还没有完成 TCP 三次握手的连接，连接只进行了一半。服务器收到了客户端的 SYN 包后，就会把这个连接放到半连接队列中，然后再向客户端发送 SYN+ACK 包。

## 协议栈统计信息

``` shell
netstat -s
```

其中展示了TCP协议的主动连接\被动连接\失败重试\发送和接收的分段数量等各种信息



## 网络吞吐和PPS

``` shell
sar -n DEV 1
```

rxpck/s 和 txpck/s 分别是接收和发送的 PPS，单位为包 / 秒。

rxkB/s 和 txkB/s 分别是接收和发送的吞吐量，单位是 KB/ 秒。

rxcmp/s 和 txcmp/s 分别是接收和发送的压缩数据包数，单位是包 / 秒。

%ifutil 是网络接口的使用率，即半双工模式下为 (rxkB/s+txkB/s)/Bandwidth，而全双工模式下为 max(rxkB/s, txkB/s)/Bandwidth。

## 连通性和延时

使用 ping ，来测试远程主机的连通性和延时，而这基于 ICMP 协议。

## 小结

通常使用带宽、吞吐量、延时等指标，来衡量网络的性能；相应的，你可以用 ifconfig、netstat、ss、sar、ping 等工具，来查看这些网络的性能指标。